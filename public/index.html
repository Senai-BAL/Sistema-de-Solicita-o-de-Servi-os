<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SENAI Lab - Solicita√ß√£o de Servi√ßos</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(45deg, #1e3c72, #2a5298);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.2rem;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .header p {
      opacity: 0.9;
      font-size: 1.1rem;
    }

    /* ===== BANNER DE TESTE ===== */
    .test-environment-banner {
      background: linear-gradient(45deg, #ff9800, #f57c00);
      color: white;
      padding: 8px 20px;
      text-align: center;
      font-weight: bold;
      font-size: 12px;
      box-shadow: 0 2px 10px rgba(255, 152, 0, 0.3);
      animation: pulse 2s infinite;
    }

    .test-environment-banner .test-icon {
      font-size: 14px;
      margin-right: 6px;
    }

    @keyframes pulse {
      0% { box-shadow: 0 2px 10px rgba(255, 152, 0, 0.3); }
      50% { box-shadow: 0 2px 20px rgba(255, 152, 0, 0.6); }
      100% { box-shadow: 0 2px 10px rgba(255, 152, 0, 0.3); }
    }

    .form-content {
      padding: 40px;
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 1rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: #fafbfc;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #4285f4;
      box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
      background: white;
    }

    .required {
      color: #e74c3c;
    }

    .service-section {
      display: none;
      margin-top: 30px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 12px;
      border-left: 4px solid #4285f4;
    }

    .service-section.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .section-title {
      font-size: 1.3rem;
      color: #1e3c72;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .file-upload {
      position: relative;
      display: inline-block;
      cursor: pointer;
      width: 100%;
    }

    .file-upload input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .file-upload-label {
      display: block;
      padding: 15px 20px;
      background: #e3f2fd;
      border: 2px dashed #2196f3;
      border-radius: 8px;
      text-align: center;
      color: #1976d2;
      font-weight: 500;
      transition: all 0.3s ease;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 5px;
    }

    .file-upload:hover .file-upload-label {
      background: #bbdefb;
      border-color: #1976d2;
    }

    .file-uploaded {
      background: #e8f5e8 !important;
      border-color: #4caf50 !important;
      color: #2e7d32 !important;
      border-style: solid !important;
    }

    .file-uploading {
      background: #fff3e0 !important;
      border-color: #ff9800 !important;
      color: #ef6c00 !important;
      border-style: solid !important;
    }

    .upload-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: #4caf50;
      border-radius: 0 0 6px 6px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .upload-progress.uploading {
      background: #ff9800;
    }

    /* üìÅ ESTILOS PARA M√öLTIPLOS ARQUIVOS */
    .file-list {
      margin-top: 15px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background: #fafafa;
      max-height: 300px;
      overflow-y: auto;
    }

    .file-list.empty {
      display: none;
    }

    .file-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      border-bottom: 1px solid #e5e5e5;
      transition: all 0.2s ease;
    }

    .file-item:last-child {
      border-bottom: none;
    }

    .file-item:hover {
      background: #f0f0f0;
    }

    .file-icon {
      font-size: 24px;
      margin-right: 12px;
      min-width: 30px;
    }

    .file-info {
      flex: 1;
      min-width: 0;
    }

    .file-name {
      font-weight: 500;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 2px;
    }

    .file-size {
      font-size: 0.85rem;
      color: #666;
    }

    .file-status {
      font-size: 0.8rem;
      margin-top: 2px;
      font-weight: 500;
    }

    .file-status.waiting {
      color: #6c757d;
    }

    .file-status.uploading {
      color: #007bff;
    }

    .file-status.success {
      color: #28a745;
    }

    .file-status.error {
      color: #dc3545;
    }

    .file-actions {
      display: flex;
      gap: 8px;
      margin-left: 10px;
    }

    .file-action-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
    }

    .file-action-btn:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    .file-action-btn.remove {
      color: #dc3545;
    }

    .file-action-btn.preview {
      color: #007bff;
    }

    .file-action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .files-summary {
      margin-top: 10px;
      padding: 10px 15px;
      background: linear-gradient(45deg, #f8f9fa, #e9ecef);
      border-radius: 6px;
      font-size: 0.9rem;
      color: #495057;
      border-left: 4px solid #007bff;
    }

    .files-summary.empty {
      display: none;
    }

    .global-progress {
      margin-top: 10px;
      padding: 0;
      display: none;
    }

    .global-progress.active {
      display: block;
    }

    .global-progress-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 5px;
    }

    .global-progress-fill {
      height: 100%;
      background: linear-gradient(45deg, #007bff, #0056b3);
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .global-progress-text {
      font-size: 0.85rem;
      color: #6c757d;
      text-align: center;
    }

    /* üñºÔ∏è PREVIEW DE IMAGENS */
    .image-preview {
      max-width: 40px;
      max-height: 40px;
      border-radius: 4px;
      margin-right: 8px;
      object-fit: cover;
      border: 1px solid #ddd;
    }

    .github-info {
      background: #f6f8fa;
      border: 1px solid #d1d9e0;
      border-radius: 6px;
      padding: 12px;
      margin-top: 10px;
      font-size: 0.85rem;
      color: #586069;
    }

    .file-info {
      background: #e8f4fd;
      border: 1px solid #b6d7ff;
      border-radius: 6px;
      padding: 10px;
      margin-top: 5px;
      font-size: 0.8rem;
      color: #0366d6;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 30px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background: #e1e5e9;
      border-radius: 2px;
      margin-bottom: 30px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(45deg, #667eea, #764ba2);
      transition: width 0.3s ease;
      width: 25%;
    }

    .success-message {
      display: none;
      text-align: center;
      padding: 40px;
      color: #27ae60;
    }

    .success-message.show {
      display: block;
    }

    .success-message h2 {
      font-size: 2rem;
      margin-bottom: 15px;
    }

    .status-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      z-index: 1000;
      opacity: 0;
      transition: all 0.3s ease;
      max-width: 300px;
    }

    .status-indicator.show {
      opacity: 1;
    }

    .status-indicator.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-indicator.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status-indicator.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .usage-monitor {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      font-size: 0.8rem;
      border: 2px solid #e1e5e9;
      min-width: 200px;
      display: none;
    }

    .usage-monitor.show {
      display: block;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(100%);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .usage-header {
      font-weight: 600;
      color: #1e3c72;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .usage-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-size: 0.75rem;
    }

    .toggle-monitor {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      font-size: 1.2rem;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .toggle-monitor:hover {
      transform: scale(1.1);
    }

    @media (max-width: 768px) {
      .row {
        grid-template-columns: 1fr;
      }

      .form-content {
        padding: 20px;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üîß SENAI Lab</h1>
      <p>Formul√°rio de Solicita√ß√£o de Servi√ßos</p>
    </div>

    <!-- Banner de Ambiente de Teste -->
    <div class="test-environment-banner" id="testBanner">
      <span class="test-icon">üß™</span>
      AMBIENTE DE TESTE ATIVO - Os dados ser√£o salvos separadamente para testes
    </div>

    <div class="form-content" id="formContent">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <form id="senaiForm">
        <!-- Dados B√°sicos -->
        <div class="form-group">
          <label for="colaborador">Colaborador <span class="required">*</span></label>
          <input type="text" id="colaborador" name="colaborador" required>
        </div>

        <div class="form-group">
          <label for="email">Email <span class="required">*</span></label>
          <input type="email" id="email" name="email" required>
        </div>

        <div class="form-group">
          <label for="whatsapp">WhatsApp <span class="required">*</span></label>
          <input type="tel" id="whatsapp" name="whatsapp" placeholder="(11)99999-9999" required>
        </div>

        <div class="form-group">
          <label for="servico">Qual servi√ßo deseja? <span class="required">*</span></label>
          <select id="servico" name="servico" required>
            <option value="">Selecione uma op√ß√£o</option>
            <option value="espaco_maker">Espa√ßo Maker</option>
            <option value="servicos">Servi√ßos</option>
            <option value="emprestimo">Empr√©stimo</option>
          </select>
        </div>

        <!-- Servi√ßos Espec√≠ficos -->
        <div class="form-group" id="tipoServico" style="display: none;">
          <label for="tipoServicoSelect">Quais servi√ßos deseja? <span class="required">*</span></label>
          <select id="tipoServicoSelect" name="tipoServicoSelect">
            <option value="">Selecione uma op√ß√£o</option>
            <option value="impressao">Impress√£o</option>
            <option value="impressao_3d">Impress√£o 3D</option>
            <option value="manutencao">Manuten√ß√£o de Equipamentos Eletr√¥nicos</option>
            <option value="arte_digital">Elabora√ß√£o de Arte Digital</option>
          </select>
        </div>

        <!-- Se√ß√£o Espa√ßo Maker -->
        <div class="service-section" id="espacoMakerSection">
          <h3 class="section-title">üìç Reserva de Espa√ßos</h3>

          <div class="form-group">
            <label for="dataReserva">Data de reserva <span class="required">*</span></label>
            <input type="date" id="dataReserva" name="dataReserva">
          </div>

          <div class="row">
            <div class="form-group">
              <label for="horarioInicio">Hor√°rio In√≠cio <span class="required">*</span></label>
              <input type="time" id="horarioInicio" name="horarioInicio">
            </div>
            <div class="form-group">
              <label for="horarioFim">Hor√°rio Fim <span class="required">*</span></label>
              <input type="time" id="horarioFim" name="horarioFim">
            </div>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="chromeBooks" name="chromeBooks">
            <label for="chromeBooks">Deseja utilizar Chrome Books?</label>
          </div>

          <div class="form-group" id="qtdChromeBooks" style="display: none;">
            <label for="qtdChromeBooksInput">Quantos? (8 dispon√≠veis)</label>
            <input type="number" id="qtdChromeBooksInput" name="qtdChromeBooksInput" min="1" max="8">
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="computadores" name="computadores">
            <label for="computadores">Deseja utilizar os Computadores?</label>
          </div>

          <div class="form-group" id="qtdComputadores" style="display: none;">
            <label for="qtdComputadoresInput">Quantos? (2 dispon√≠veis)</label>
            <input type="number" id="qtdComputadoresInput" name="qtdComputadoresInput" min="1" max="2">
          </div>

          <div class="form-group">
            <label for="descricaoUtilizacao">Descreva as ideias e sua utiliza√ß√£o <span class="required">*</span></label>
            <textarea id="descricaoUtilizacao" name="descricaoUtilizacao" rows="4"></textarea>
          </div>
        </div>

        <!-- Se√ß√£o Impress√£o -->
        <div class="service-section" id="impressaoSection">
          <h3 class="section-title">üñ®Ô∏è Descri√ß√£o das Impress√µes</h3>
          <p style="margin-bottom: 20px; color: #666;">
            <strong>Limites:</strong><br>
            A3 - √önico lado: 10 folhas | Frente e verso: 5 folhas<br>
            A4 - √önico lado: 30 folhas | Frente e verso: 60 folhas
          </p>

          <div class="form-group">
            <label for="tamanhoFolha">Tamanho da Folha <span class="required">*</span></label>
            <select id="tamanhoFolha" name="tamanhoFolha">
              <option value="">Selecione</option>
              <option value="A3">A3</option>
              <option value="A4">A4</option>
            </select>
          </div>

          <div class="form-group">
            <label for="qtdCopias">Quantidade de C√≥pias <span class="required">*</span></label>
            <input type="number" id="qtdCopias" name="qtdCopias" min="1">
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="frenteVerso" name="frenteVerso">
            <label for="frenteVerso">Frente e Verso</label>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="escanear" name="escanear">
            <label for="escanear">Necess√°rio Escanear</label>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="colorido" name="colorido">
            <label for="colorido">Colorido</label>
          </div>

          <div class="form-group">
            <label for="arquivoImpressao">Anexar arquivos de impress√£o</label>
            <div class="file-upload">
              <input type="file" id="arquivoImpressao" name="arquivoImpressao" accept=".pdf,.doc,.docx,.jpg,.png,.jpeg" multiple>
              <label for="arquivoImpressao" class="file-upload-label">
                <span>üìÑ Clique para selecionar arquivos</span>
                <small>PDF, DOC, JPG, PNG (m√°x. 100MB cada) - M√∫ltiplos arquivos permitidos</small>
              </label>
              <div class="upload-progress"></div>
            </div>
            <div class="file-list empty" id="fileListImpressao"></div>
            <div class="files-summary empty" id="filesSummaryImpressao">
              <strong>üìÅ Arquivos selecionados:</strong> <span class="count">0</span> arquivo(s) | 
              <span class="size">0 KB</span>
            </div>
            <div class="global-progress" id="globalProgressImpressao">
              <div class="global-progress-bar">
                <div class="global-progress-fill"></div>
              </div>
              <div class="global-progress-text">Fazendo upload...</div>
            </div>
            <div class="github-info">
              <strong>üìÅ Upload autom√°tico:</strong> Arquivos ser√£o enviados automaticamente para o GitHub com nomenclatura padronizada: TIPO_DATA_SOLICITANTE_ARQUIVO. M√°ximo 100MB por arquivo.
            </div>
          </div>
        </div>

        <!-- Se√ß√£o Impress√£o 3D -->
        <div class="service-section" id="impressao3dSection">
          <h3 class="section-title">üèóÔ∏è Descri√ß√£o das Impress√µes 3D</h3>

          <div class="form-group">
            <label for="material">Material <span class="required">*</span></label>
            <select id="material" name="material">
              <option value="">Selecione</option>
              <option value="ABS">ABS</option>
              <option value="PLA">PLA</option>
            </select>
          </div>

          <div class="form-group">
            <label for="quantidade3d">Quantidade <span class="required">*</span></label>
            <input type="number" id="quantidade3d" name="quantidade3d" min="1">
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="possuiSTL" name="possuiSTL" checked>
            <label for="possuiSTL">Possui o arquivo STL?</label>
          </div>

          <div class="form-group" id="arquivoSTLGroup">
            <label for="arquivoSTL">Anexar arquivos STL</label>
            <div class="file-upload">
              <input type="file" id="arquivoSTL" name="arquivoSTL" accept=".stl" multiple>
              <label for="arquivoSTL" class="file-upload-label">
                <span>üìê Clique para selecionar arquivos STL</span>
                <small>Arquivos STL (m√°x. 100MB cada) - M√∫ltiplos arquivos permitidos</small>
              </label>
              <div class="upload-progress"></div>
            </div>
            <div class="file-list empty" id="fileListSTL"></div>
            <div class="files-summary empty" id="filesSummarySTL">
              <strong>üìê Arquivos STL:</strong> <span class="count">0</span> arquivo(s) | 
              <span class="size">0 KB</span>
            </div>
            <div class="global-progress" id="globalProgressSTL">
              <div class="global-progress-bar">
                <div class="global-progress-fill"></div>
              </div>
              <div class="global-progress-text">Fazendo upload...</div>
            </div>
            <div class="github-info">
              <strong>üèóÔ∏è Upload STL:</strong> Arquivos 3D ser√£o armazenados automaticamente no GitHub.
            </div>
          </div>

          <div class="form-group" id="descricaoPecaGroup" style="display: none;">
            <label for="descricaoPeca">Descreva a pe√ßa <span class="required">*</span></label>
            <textarea id="descricaoPeca" name="descricaoPeca" rows="4"></textarea>
          </div>
        </div>

        <!-- Se√ß√£o Manuten√ß√£o -->
        <div class="service-section" id="manutencaoSection">
          <h3 class="section-title">üîß Manuten√ß√£o de Equipamentos</h3>

          <div class="form-group">
            <label for="descricaoProblema">Descreva o problema <span class="required">*</span></label>
            <textarea id="descricaoProblema" name="descricaoProblema" rows="4"></textarea>
          </div>

          <div class="form-group">
            <label for="fotoProblema">Anexar fotos do problema</label>
            <div class="file-upload">
              <input type="file" id="fotoProblema" name="fotoProblema" accept="image/*" multiple>
              <label for="fotoProblema" class="file-upload-label">
                <span>üì∑ Clique para tirar/selecionar fotos</span>
                <small>Fotos ou imagens (m√°x. 100MB cada) - M√∫ltiplas fotos permitidas</small>
              </label>
              <div class="upload-progress"></div>
            </div>
            <div class="file-list empty" id="fileListProblema"></div>
            <div class="files-summary empty" id="filesSummaryProblema">
              <strong>üì∑ Fotos do problema:</strong> <span class="count">0</span> foto(s) | 
              <span class="size">0 KB</span>
            </div>
            <div class="global-progress" id="globalProgressProblema">
              <div class="global-progress-bar">
                <div class="global-progress-fill"></div>
              </div>
              <div class="global-progress-text">Fazendo upload...</div>
            </div>
            <div class="github-info">
              <strong>üì∑ Fotos autom√°ticas:</strong> Tire m√∫ltiplas fotos ou selecione da galeria. Nomenclatura: MANUTENCAO_DATA_SOLICITANTE_FOTO. Upload autom√°tico.
            </div>
          </div>
        </div>

        <!-- Se√ß√£o Arte Digital/ -->
        <div class="service-section" id="arteProjetoSection">
          <h3 class="section-title">üé® Arte Digital</h3>

          <div class="form-group">
            <label for="descricaoArteProjeto">Descreva as ideias e sua utiliza√ß√£o <span class="required">*</span></label>
            <textarea id="descricaoArteProjeto" name="descricaoArteProjeto" rows="4"></textarea>
          </div>
        </div>

        <!-- Se√ß√£o Empr√©stimo -->
        <div class="service-section" id="emprestimoSection">
          <h3 class="section-title">üì¶ Empr√©stimo</h3>

          <div class="form-group">
            <label for="nomeItem">Nome do Item <span class="required">*</span></label>
            <input type="text" id="nomeItem" name="nomeItem">
          </div>

          <div class="row">
            <div class="form-group">
              <label for="dataRetirada">Data Retirada <span class="required">*</span></label>
              <input type="date" id="dataRetirada" name="dataRetirada">
            </div>
            <div class="form-group">
              <label for="dataDevolucao">Data Devolu√ß√£o <span class="required">*</span></label>
              <input type="date" id="dataDevolucao" name="dataDevolucao">
            </div>
          </div>

          <div class="form-group">
            <label for="fotoItem">Fotos do Item <span class="required">*</span></label>
            <div class="file-upload">
              <input type="file" id="fotoItem" name="fotoItem" accept="image/*" multiple>
              <label for="fotoItem" class="file-upload-label">
                <span>üì∑ Clique para tirar/selecionar fotos</span>
                <small>Fotos obrigat√≥rias (m√°x. 100MB cada) - M√∫ltiplas fotos permitidas</small>
              </label>
              <div class="upload-progress"></div>
            </div>
            <div class="file-list empty" id="fileListItem"></div>
            <div class="files-summary empty" id="filesSummaryItem">
              <strong>üì∑ Fotos do item:</strong> <span class="count">0</span> foto(s) | 
              <span class="size">0 KB</span>
            </div>
            <div class="global-progress" id="globalProgressItem">
              <div class="global-progress-bar">
                <div class="global-progress-fill"></div>
              </div>
              <div class="global-progress-text">Fazendo upload...</div>
            </div>
            <div class="github-info">
              <strong>üì∑ Fotos obrigat√≥rias:</strong> Necess√°rias para identifica√ß√£o do item. Nomenclatura: EMPRESTIMO_DATA_SOLICITANTE_FOTO. Upload autom√°tico.
            </div>
          </div>
        </div>

        <button type="submit" class="btn" id="submitBtn">
          <span id="btnText">‚úâÔ∏è Enviar Solicita√ß√£o</span>
          <span id="loadingText" style="display: none;">‚è≥ Enviando...</span>
        </button>
      </form>
    </div>

    <div class="success-message" id="successMessage">
      <h2>‚úÖ Solicita√ß√£o Enviada!</h2>
      <p>Sua solicita√ß√£o foi registrada com sucesso. Em breve entraremos em contato.</p>
      <p id="submissionId" style="font-size: 0.9rem; color: #666; margin-top: 10px;"></p>
      <button class="btn" onclick="resetForm()" style="margin-top: 20px;">
        üìù Nova Solicita√ß√£o
      </button>
    </div>
  </div>

  <!-- Status Indicator -->
  <div class="status-indicator" id="statusIndicator"></div>

  <!-- Monitor de Uso -->
  <button class="toggle-monitor" onclick="toggleUsageMonitor()" title="Monitor de Uso">
    üìä
  </button>

  <div class="usage-monitor" id="usageMonitor">
    <div class="usage-header">
      üî• Sistema H√≠brido
      <span style="margin-left: auto; cursor: pointer;" onclick="toggleUsageMonitor()">‚úï</span>
    </div>

    <div class="usage-item">
      <span>Firestore writes:</span>
      <span id="writesCount">0 / 20k</span>
    </div>

    <div class="usage-item">
      <span>GitHub uploads:</span>
      <span id="uploadsCount">0 uploads</span>
    </div>

    <div class="usage-item">
      <span>Storage:</span>
      <span style="color: #4caf50;">‚úÖ GitHub (1GB)</span>
    </div>

    <div class="usage-item">
      <span>Status:</span>
      <span id="apiStatus" style="color: #4caf50;">‚úÖ Funcionando</span>
    </div>

    <div style="font-size: 0.7rem; color: #666; margin-top: 8px; text-align: center;">
      Firebase + GitHub - 100% gratuito üíæ
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <!-- Firebase Configuration -->
  <script src="shared/firebase-config.js"></script>
  
  <!-- GitHub Configuration -->
  <script src="shared/github-config.js"></script>

  <script>
    // üî• VERIFICAR SE A CONFIGURA√á√ÉO FIREBASE FOI CARREGADA
    if (!window.firebaseConfig) {
      alert('‚ö†Ô∏è Erro: Arquivo firebase-config.js n√£o encontrado!\n\nPor favor:\n1. Copie shared/firebase-config.example.js para shared/firebase-config.js\n2. Substitua pelas suas credenciais Firebase');
      throw new Error('Firebase configuration not found');
    }

    // üêô VERIFICAR SE A CONFIGURA√á√ÉO GITHUB FOI CARREGADA
    if (!window.githubConfig) {
      alert('‚ö†Ô∏è Erro: Arquivo github-config.js n√£o encontrado!\n\nPor favor:\n1. Copie shared/github-config.example.js para shared/github-config.js\n2. Substitua pelas suas credenciais GitHub');
      throw new Error('GitHub configuration not found');
    }

    // Inicializar Firebase com a configura√ß√£o externa
    firebase.initializeApp(window.firebaseConfig);
    const db = firebase.firestore();
    
    // üß™ CONFIGURA√á√ÉO DE AMBIENTE
    const ENVIRONMENT_CONFIG = {
      // Altere para 'production' ou 'test' conforme necess√°rio
      mode: 'test', // 'production' ou 'test'
      collections: {
        production: 'solicitacoes',
        test: 'solicitacoes_test'
      }
    };
    
    const collectionName = ENVIRONMENT_CONFIG.collections[ENVIRONMENT_CONFIG.mode];
    console.log(`üî• Firebase Service iniciado em modo: ${ENVIRONMENT_CONFIG.mode.toUpperCase()}`);
    console.log(`üìÇ Cole√ß√£o: ${collectionName}`);

    // Ativar cache offline
    db.enablePersistence().catch((err) => {
      console.log('Cache offline n√£o dispon√≠vel:', err.code);
    });

    // üêô CONFIGURA√á√ÉO GITHUB API (carregada externamente)
    const GITHUB_CONFIG = window.githubConfig;

    // üìä MONITOR DE USO
    const usageMonitor = {
      dailyWrites: parseInt(localStorage.getItem('dailyWrites') || '0'),
      dailyUploads: parseInt(localStorage.getItem('dailyUploads') || '0'),
      lastReset: localStorage.getItem('lastReset') || new Date().toDateString(),

      reset() {
        const today = new Date().toDateString();
        if (this.lastReset !== today) {
          this.dailyWrites = 0;
          this.dailyUploads = 0;
          this.lastReset = today;
          this.save();
        }
      },

      save() {
        localStorage.setItem('dailyWrites', this.dailyWrites.toString());
        localStorage.setItem('dailyUploads', this.dailyUploads.toString());
        localStorage.setItem('lastReset', this.lastReset);
      },

      addWrite() {
        this.reset();
        this.dailyWrites++;
        this.save();
      },

      addUpload() {
        this.reset();
        this.dailyUploads++;
        this.save();
      }
    };

    // üñºÔ∏è COMPRESS√ÉO DE IMAGENS
    function compressImage(file, maxWidth = 1200, quality = 0.8) {
      return new Promise((resolve) => {
        if (!file.type.startsWith('image/')) {
          resolve(file); // N√£o √© imagem, retorna original
          return;
        }

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();

        img.onload = function() {
          let { width, height } = this;

          if (width > maxWidth) {
            height = (height * maxWidth) / width;
            width = maxWidth;
          }

          canvas.width = width;
          canvas.height = height;
          ctx.drawImage(this, 0, 0, width, height);

          canvas.toBlob((blob) => {
            // Criar novo arquivo com nome original
            const compressedFile = new File([blob], file.name, {
              type: 'image/jpeg',
              lastModified: Date.now()
            });
            resolve(compressedFile);
          }, 'image/jpeg', quality);
        };

        img.src = URL.createObjectURL(file);
      });
    }

    // üêô UPLOAD PARA GITHUB COM NOVO PADR√ÉO DE NOMENCLATURA
    async function uploadToGitHub(file, serviceInfo, progressCallback) {
      try {
        // Comprimir imagem se necess√°rio
        const fileToUpload = await compressImage(file);
        
        if (progressCallback) progressCallback(30);

        // Gerar novo padr√£o: TIPO_DATA_SOLICITANTE_NOMEDOARQUIVO
        const now = new Date();
        const dateStr = now.toISOString().slice(0, 10).replace(/-/g, ''); // YYYYMMDD
        const timeStr = now.toTimeString().slice(0, 8).replace(/:/g, ''); // HHMMSS
        const timestamp = `${dateStr}_${timeStr}`;
        
        // Limpar nome do solicitante (remover caracteres especiais)
        const cleanSolicitante = serviceInfo.solicitante
          .replace(/[^a-zA-Z0-9]/g, '')
          .slice(0, 20)
          .toUpperCase();
        
        // Limpar nome do arquivo original
        const originalName = file.name.replace(/\.[^/.]+$/, "").replace(/[^a-zA-Z0-9._-]/g, '');
        const extension = file.name.split('.').pop();
        
        // Novo padr√£o: TIPO_DATA_SOLICITANTE_NOMEDOARQUIVO
        const fileName = `${serviceInfo.tipo}_${timestamp}_${cleanSolicitante}_${originalName}.${extension}`;
        
        // PASTA √öNICA PARA TODOS OS ARQUIVOS
        const filePath = `senai-arquivos/${fileName}`;

        if (progressCallback) progressCallback(50);

        // Converter para base64
        const base64Content = await fileToBase64(fileToUpload);
        
        if (progressCallback) progressCallback(70);

        // API GitHub
        const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}/contents/${filePath}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${GITHUB_CONFIG.token}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            message: `Upload: ${fileName}`,
            content: base64Content
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(`GitHub API Error: ${error.message}`);
        }

        const result = await response.json();
        
        if (progressCallback) progressCallback(100);

        // URL p√∫blica do arquivo
        const publicUrl = `https://raw.githubusercontent.com/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${filePath}`;

        // Registrar upload
        usageMonitor.addUpload();

        return {
          name: file.name,
          url: publicUrl,
          size: fileToUpload.size,
          originalSize: file.size,
          type: fileToUpload.type,
          compressed: file.type.startsWith('image/'),
          path: filePath
        };

      } catch (error) {
        console.error('‚ùå Erro no upload para GitHub:', error);
        throw error;
      }
    }

    // üîÑ CONVERTER ARQUIVO PARA BASE64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
      });
    }

    // üìã COLETA DE DADOS OTIMIZADA
    function collectFormData() {
      const form = document.getElementById('senaiForm');
      const formData = new FormData(form);

      const data = {
        c: formData.get('colaborador'),
        e: formData.get('email'),
        w: formData.get('whatsapp').replace(/\D/g, ''), // Remove m√°scara do WhatsApp
        s: formData.get('servico'),
        st: 'p',
        d: Date.now(),
        dados: {},
        fonte: 'github'
      };

      // Dados espec√≠ficos por servi√ßo
      if (data.s === 'espaco_maker') {
        data.dados = {
          dr: formData.get('dataReserva'),
          hi: formData.get('horarioInicio'),
          hf: formData.get('horarioFim'),
          cb: formData.get('chromeBooks') === 'on' ? 1 : 0,
          qcb: parseInt(formData.get('qtdChromeBooksInput')) || 0,
          cp: formData.get('computadores') === 'on' ? 1 : 0,
          qcp: parseInt(formData.get('qtdComputadoresInput')) || 0,
          desc: formData.get('descricaoUtilizacao')
        };
      } else if (data.s === 'servicos') {
        const ts = formData.get('tipoServicoSelect');
        data.ts = ts;

        if (ts === 'impressao') {
          data.dados = {
            tf: formData.get('tamanhoFolha'),
            qc: parseInt(formData.get('qtdCopias')),
            fv: formData.get('frenteVerso') === 'on' ? 1 : 0,
            es: formData.get('escanear') === 'on' ? 1 : 0,
            co: formData.get('colorido') === 'on' ? 1 : 0
          };
        } else if (ts === 'impressao_3d') {
          data.dados = {
            mt: formData.get('material'),
            qt: parseInt(formData.get('quantidade3d')),
            stl: formData.get('possuiSTL') === 'on' ? 1 : 0,
            dp: formData.get('descricaoPeca')
          };
        } else if (ts === 'manutencao') {
          data.dados = {
            prob: formData.get('descricaoProblema')
          };
        } else if (ts === 'arte_digital' || ts === 'projeto') {
          data.dados = {
            desc: formData.get('descricaoArteProjeto')
          };
        }
      } else if (data.s === 'emprestimo') {
        data.dados = {
          ni: formData.get('nomeItem'),
          dr: formData.get('dataRetirada'),
          dd: formData.get('dataDevolucao')
        };
      }

      return data;
    }

    // üè∑Ô∏è GERAR INFORMA√á√ïES PARA UPLOAD
    function generateServiceInfo(formData) {
      let tipo = '';
      
      if (formData.s === 'espaco_maker') {
        tipo = 'ESPACO_MAKER';
      } else if (formData.s === 'servicos') {
        const ts = formData.ts;
        if (ts === 'impressao') tipo = 'IMPRESSAO';
        else if (ts === 'impressao_3d') tipo = 'IMPRESSAO_3D';
        else if (ts === 'manutencao') tipo = 'MANUTENCAO';
        else if (ts === 'arte_digital') tipo = 'ARTE_DIGITAL';
        else if (ts === 'projeto') tipo = 'PROJETO';
        else tipo = 'SERVICOS';
      } else if (formData.s === 'emprestimo') {
        tipo = 'EMPRESTIMO';
      } else {
        tipo = 'OUTROS';
      }

      return {
        tipo: tipo,
        solicitante: formData.c || 'USUARIO',
        email: formData.e || ''
      };
    }

    // üöÄ ENVIO COM UPLOAD AUTOM√ÅTICO
    async function submitForm() {
      const submitBtn = document.getElementById('submitBtn');
      const btnText = document.getElementById('btnText');
      const loadingText = document.getElementById('loadingText');

      try {
        submitBtn.disabled = true;
        btnText.style.display = 'none';
        loadingText.style.display = 'inline';

        if (!navigator.onLine) {
          throw new Error('Sem conex√£o com a internet.');
        }

        const formData = collectFormData();
        
        // Gerar informa√ß√µes de servi√ßo para upload
        const serviceInfo = generateServiceInfo(formData);
        
        // üîç DEBUG: Mostrar novo padr√£o de nomenclatura
        console.log('üîß NOVO PADR√ÉO DE NOMENCLATURA:');
        console.log(`üìÇ Pasta: senai-arquivos/`);
        console.log(`üè∑Ô∏è Padr√£o: ${serviceInfo.tipo}_DATA_${serviceInfo.solicitante.replace(/[^a-zA-Z0-9]/g, '').slice(0, 20).toUpperCase()}_ARQUIVO`);
        console.log(`üë§ Solicitante processado: ${serviceInfo.solicitante} ‚Üí ${serviceInfo.solicitante.replace(/[^a-zA-Z0-9]/g, '').slice(0, 20).toUpperCase()}`);

        // Upload de arquivos para GitHub com novo padr√£o
        const arquivos = [];
        const maxRetries = 3;

        // Upload baseado no tipo de servi√ßo usando novos gerenciadores
        const uploadPromises = [];

        if (formData.s === 'servicos') {
          const tipoServico = formData.ts;

          if (tipoServico === 'impressao') {
            const manager = multiFileManagers['arquivoImpressao'];
            if (manager && manager.hasFiles()) {
              loadingText.textContent = '‚è≥ Enviando arquivos de impress√£o...';
              const results = await manager.uploadAll(serviceInfo);
              arquivos.push(...results);
            }
          } else if (tipoServico === 'impressao_3d') {
            const manager = multiFileManagers['arquivoSTL'];
            if (manager && manager.hasFiles()) {
              loadingText.textContent = '‚è≥ Enviando arquivos STL...';
              const results = await manager.uploadAll(serviceInfo);
              arquivos.push(...results);
            }
          } else if (tipoServico === 'manutencao') {
            const manager = multiFileManagers['fotoProblema'];
            if (manager && manager.hasFiles()) {
              loadingText.textContent = '‚è≥ Enviando fotos do problema...';
              const results = await manager.uploadAll(serviceInfo);
              arquivos.push(...results);
            }
          }
        } else if (formData.s === 'emprestimo') {
          const manager = multiFileManagers['fotoItem'];
          if (manager && manager.hasFiles()) {
            loadingText.textContent = '‚è≥ Enviando fotos do item...';
            const results = await manager.uploadAll(serviceInfo);
            arquivos.push(...results);
          }
        }

        // Adicionar arquivos aos dados
        if (arquivos.length > 0) {
          formData.arq = arquivos.map(arq => ({
            n: arq.name,
            u: arq.url,
            s: arq.size,
            t: arq.type,
            p: arq.path
          }));
        }

        // Salvar no Firestore
        loadingText.textContent = '‚è≥ Salvando dados...';
        const docRef = await db.collection(collectionName).add(formData);

        console.log('‚úÖ Solicita√ß√£o enviada com ID:', docRef.id);

        usageMonitor.addWrite();
        showSuccessScreen(docRef.id);

      } catch (error) {
        console.error('‚ùå Erro ao enviar:', error);

        let errorMessage = 'Erro ao enviar solicita√ß√£o. ';
        if (error.message.includes('GitHub')) {
          errorMessage += 'Problema no upload de arquivos.';
        } else if (error.message.includes('quota')) {
          errorMessage += 'Limite di√°rio atingido.';
        } else {
          errorMessage += 'Tente novamente.';
        }

        showStatus(errorMessage, 'error');

        submitBtn.disabled = false;
        btnText.style.display = 'inline';
        loadingText.style.display = 'none';
      }
    }

    // üîÑ RETRY PARA UPLOADS COM NOVO PADR√ÉO
    async function retryUpload(file, serviceInfo, maxRetries) {
      for (let attempt = 1; attempt <= maxRetries; attempt++) {
        try {
          return await uploadToGitHub(file, serviceInfo);
        } catch (error) {
          console.warn(`‚ùå Tentativa ${attempt}/${maxRetries} falhou:`, error.message);

          if (attempt === maxRetries) {
            throw error;
          }

          await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));
        }
      }
    }

    // üéâ TELA DE SUCESSO
    function showSuccessScreen(docId) {
      document.getElementById('formContent').style.display = 'none';
      document.getElementById('successMessage').classList.add('show');
      document.getElementById('submissionId').textContent = `ID: ${docId}`;

      const stats = JSON.parse(localStorage.getItem('senaiStats') || '{}');
      stats.totalSubmissions = (stats.totalSubmissions || 0) + 1;
      stats.lastSubmission = Date.now();
      localStorage.setItem('senaiStats', JSON.stringify(stats));
    }

    // üìä MONITOR DE USO
    function updateUsageMonitor() {
      usageMonitor.reset();
      document.getElementById('writesCount').textContent = `${usageMonitor.dailyWrites} / 20k`;
      document.getElementById('uploadsCount').textContent = `${usageMonitor.dailyUploads} uploads`;
    }

    function toggleUsageMonitor() {
      const monitor = document.getElementById('usageMonitor');
      const button = document.querySelector('.toggle-monitor');

      if (monitor.classList.contains('show')) {
        monitor.classList.remove('show');
        button.style.display = 'block';
      } else {
        monitor.classList.add('show');
        button.style.display = 'none';
        updateUsageMonitor();
      }
    }

    // üì¢ MOSTRAR STATUS
    function showStatus(message, type = 'info') {
      const indicator = document.getElementById('statusIndicator');
      indicator.textContent = message;
      indicator.className = `status-indicator ${type} show`;

      setTimeout(() => {
        indicator.classList.remove('show');
      }, 4000);
    }

    // üìÅ SISTEMA DE M√öLTIPLOS ARQUIVOS
    class MultiFileManager {
      constructor(inputId, listId, summaryId, progressId) {
        this.inputId = inputId;
        this.listId = listId;
        this.summaryId = summaryId;
        this.progressId = progressId;
        this.files = new Map();
        this.uploadQueue = [];
        this.isUploading = false;
        
        this.setupEventListeners();
      }

      setupEventListeners() {
        const input = document.getElementById(this.inputId);
        if (!input) return;

        input.addEventListener('change', (e) => {
          this.handleFileSelection(e.target.files);
        });
      }

      handleFileSelection(fileList) {
        const newFiles = Array.from(fileList);
        
        // Validar cada arquivo
        for (const file of newFiles) {
          if (!this.validateFile(file)) {
            continue;
          }

          // Adicionar arquivo √† lista (evitar duplicatas)
          const fileKey = `${file.name}_${file.size}_${file.lastModified}`;
          if (!this.files.has(fileKey)) {
            this.files.set(fileKey, {
              file: file,
              id: fileKey,
              status: 'waiting',
              uploadResult: null,
              error: null
            });
          }
        }

        this.updateDisplay();
        this.updateSummary();
      }

      validateFile(file) {
        // Validar tamanho (100MB m√°ximo)
        if (file.size > 100 * 1024 * 1024) {
          showStatus(`üìÅ Arquivo "${file.name}" muito grande! M√°ximo: 100MB`, 'error');
          return false;
        }

        // Validar tipo de arquivo baseado no inputId
        const allowedTypes = {
          'arquivoImpressao': ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png'],
          'arquivoSTL': ['.stl'],
          'fotoProblema': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'],
          'fotoItem': ['image/jpeg', 'image/jpg', 'image/png', 'image/gif']
        };

        if (allowedTypes[this.inputId]) {
          if (this.inputId.includes('foto') || this.inputId.includes('Problema') || this.inputId.includes('Item')) {
            // Para fotos, verificar mime type
            if (!allowedTypes[this.inputId].includes(file.type)) {
              showStatus(`‚ùå Tipo "${file.name}" n√£o permitido! Aceitos: JPG, PNG, GIF`, 'error');
              return false;
            }
          } else {
            // Para outros arquivos, verificar extens√£o
            const extension = '.' + file.name.split('.').pop().toLowerCase();
            if (!allowedTypes[this.inputId].includes(extension)) {
              showStatus(`‚ùå Tipo "${file.name}" n√£o permitido! Aceitos: ${allowedTypes[this.inputId].join(', ')}`, 'error');
              return false;
            }
          }
        }

        return true;
      }

      updateDisplay() {
        const listElement = document.getElementById(this.listId);
        if (!listElement) return;

        if (this.files.size === 0) {
          listElement.classList.add('empty');
          listElement.innerHTML = '';
          return;
        }

        listElement.classList.remove('empty');
        listElement.innerHTML = '';

        this.files.forEach((fileData, fileKey) => {
          const fileItem = this.createFileItem(fileData);
          listElement.appendChild(fileItem);
        });
      }

      createFileItem(fileData) {
        const { file, id, status, error } = fileData;
        const item = document.createElement('div');
        item.className = 'file-item';
        item.setAttribute('data-file-id', id);

        const isImage = file.type.startsWith('image/');
        const fileIcon = this.getFileIcon(file);
        const fileSize = this.formatFileSize(file.size);

        // Preview de imagem se for imagem
        let imagePreview = '';
        if (isImage) {
          const imageUrl = URL.createObjectURL(file);
          imagePreview = `<img src="${imageUrl}" alt="Preview" class="image-preview">`;
        }

        const statusClass = status === 'waiting' ? 'waiting' : 
                           status === 'uploading' ? 'uploading' :
                           status === 'success' ? 'success' : 'error';

        const statusText = status === 'waiting' ? 'Aguardando...' :
                          status === 'uploading' ? 'Enviando...' :
                          status === 'success' ? 'Enviado ‚úì' :
                          `Erro: ${error}`;

        item.innerHTML = `
          ${imagePreview}
          <div class="file-icon">${fileIcon}</div>
          <div class="file-info">
            <div class="file-name" title="${file.name}">${file.name}</div>
            <div class="file-size">${fileSize}</div>
            <div class="file-status ${statusClass}">${statusText}</div>
          </div>
          <div class="file-actions">
            ${isImage ? `<button type="button" class="file-action-btn preview" onclick="multiFileManagers['${this.inputId}'].previewImage('${id}')" title="Visualizar">üëÅÔ∏è</button>` : ''}
            <button type="button" class="file-action-btn remove" onclick="multiFileManagers['${this.inputId}'].removeFile('${id}')" title="Remover" ${status === 'uploading' ? 'disabled' : ''}>üóëÔ∏è</button>
          </div>
        `;

        return item;
      }

      getFileIcon(file) {
        if (file.type.startsWith('image/')) return 'üì∑';
        if (file.name.toLowerCase().endsWith('.pdf')) return 'üìÑ';
        if (file.name.toLowerCase().endsWith('.stl')) return 'üìê';
        if (file.name.toLowerCase().includes('.doc')) return 'üìù';
        return 'üìÅ';
      }

      formatFileSize(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
      }

      updateSummary() {
        const summaryElement = document.getElementById(this.summaryId);
        if (!summaryElement) return;

        if (this.files.size === 0) {
          summaryElement.classList.add('empty');
          return;
        }

        summaryElement.classList.remove('empty');
        const totalSize = Array.from(this.files.values()).reduce((sum, fileData) => sum + fileData.file.size, 0);
        
        summaryElement.querySelector('.count').textContent = this.files.size;
        summaryElement.querySelector('.size').textContent = this.formatFileSize(totalSize);
      }

      removeFile(fileId) {
        this.files.delete(fileId);
        this.updateDisplay();
        this.updateSummary();
        showStatus('üìÅ Arquivo removido', 'info');
      }

      previewImage(fileId) {
        const fileData = this.files.get(fileId);
        if (!fileData || !fileData.file.type.startsWith('image/')) return;

        const imageUrl = URL.createObjectURL(fileData.file);
        window.open(imageUrl, '_blank');
      }

      async uploadAll(serviceInfo) {
        if (this.files.size === 0) return [];

        this.isUploading = true;
        const progressElement = document.getElementById(this.progressId);
        if (progressElement) {
          progressElement.classList.add('active');
        }

        const results = [];
        let completed = 0;
        const total = this.files.size;

        for (const [fileId, fileData] of this.files) {
          try {
            // Atualizar status do arquivo
            fileData.status = 'uploading';
            this.updateDisplay();

            // Fazer upload com novo padr√£o
            const result = await retryUpload(fileData.file, serviceInfo, 3);
            if (result) {
              fileData.status = 'success';
              fileData.uploadResult = result;
              results.push(result);
            } else {
              fileData.status = 'error';
              fileData.error = 'Falha no upload';
            }
          } catch (error) {
            fileData.status = 'error';
            fileData.error = error.message;
          }

          completed++;
          
          // Atualizar progresso global
          if (progressElement) {
            const progressBar = progressElement.querySelector('.global-progress-fill');
            const progressText = progressElement.querySelector('.global-progress-text');
            const percentage = (completed / total) * 100;
            
            if (progressBar) progressBar.style.width = `${percentage}%`;
            if (progressText) progressText.textContent = `Enviando... ${completed}/${total}`;
          }

          this.updateDisplay();
        }

        // Finalizar progresso
        if (progressElement) {
          setTimeout(() => {
            progressElement.classList.remove('active');
          }, 1000);
        }

        this.isUploading = false;
        return results;
      }

      getFiles() {
        return Array.from(this.files.values()).map(fileData => fileData.file);
      }

      hasFiles() {
        return this.files.size > 0;
      }

      clear() {
        this.files.clear();
        this.updateDisplay();
        this.updateSummary();
      }
    }

    // üìÅ GERENCIADORES DE M√öLTIPLOS ARQUIVOS
    let multiFileManagers = {};

    // üìÅ CONTROLE DE UPLOAD COM PROGRESS (VERS√ÉO LEGACY PARA COMPATIBILIDADE)
    // üìÅ INICIALIZAR GERENCIADORES DE M√öLTIPLOS ARQUIVOS
    function initializeMultiFileManagers() {
      multiFileManagers = {
        'arquivoImpressao': new MultiFileManager('arquivoImpressao', 'fileListImpressao', 'filesSummaryImpressao', 'globalProgressImpressao'),
        'arquivoSTL': new MultiFileManager('arquivoSTL', 'fileListSTL', 'filesSummarySTL', 'globalProgressSTL'),
        'fotoProblema': new MultiFileManager('fotoProblema', 'fileListProblema', 'filesSummaryProblema', 'globalProgressProblema'),
        'fotoItem': new MultiFileManager('fotoItem', 'fileListItem', 'filesSummaryItem', 'globalProgressItem')
      };
    }

    // NAVEGA√á√ÉO DO FORMUL√ÅRIO
    document.getElementById('servico').addEventListener('change', function () {
      const value = this.value;
      hideAllSections();
      
      // Resetar e esconder o select de tipo de servi√ßo
      document.getElementById('tipoServico').style.display = 'none';
      document.getElementById('tipoServicoSelect').value = '';

      if (value === 'servicos') {
        document.getElementById('tipoServico').style.display = 'block';
      } else if (value === 'espaco_maker') {
        showSection('espacoMakerSection');
      } else if (value === 'emprestimo') {
        showSection('emprestimoSection');
      }
      updateProgress();
    });

    document.getElementById('tipoServicoSelect').addEventListener('change', function () {
      const value = this.value;
      hideAllSections();

      if (value === 'impressao') {
        showSection('impressaoSection');
      } else if (value === 'impressao_3d') {
        showSection('impressao3dSection');
      } else if (value === 'manutencao') {
        showSection('manutencaoSection');
      } else if (value === 'arte_digital' || value === 'projeto') {
        showSection('arteProjetoSection');
      }
      updateProgress();
    });

    document.getElementById('chromeBooks').addEventListener('change', function () {
      document.getElementById('qtdChromeBooks').style.display = this.checked ? 'block' : 'none';
    });

    document.getElementById('computadores').addEventListener('change', function () {
      document.getElementById('qtdComputadores').style.display = this.checked ? 'block' : 'none';
    });

    document.getElementById('possuiSTL').addEventListener('change', function () {
      const stlGroup = document.getElementById('arquivoSTLGroup');
      const descGroup = document.getElementById('descricaoPecaGroup');

      if (this.checked) {
        stlGroup.style.display = 'block';
        descGroup.style.display = 'none';
      } else {
        stlGroup.style.display = 'none';
        descGroup.style.display = 'block';
      }
    });

    // üì± M√ÅSCARA PARA WHATSAPP
    document.getElementById('whatsapp').addEventListener('input', function (e) {
      let value = e.target.value.replace(/\D/g, ''); // Remove tudo que n√£o √© d√≠gito
      let formattedValue = '';
      
      // Aplicar m√°scara baseada no comprimento
      if (value.length === 0) {
        formattedValue = '';
      } else if (value.length <= 2) {
        formattedValue = `(${value}`;
      } else if (value.length <= 7) {
        formattedValue = `(${value.substring(0, 2)}) ${value.substring(2)}`;
      } else if (value.length <= 11) {
        formattedValue = `(${value.substring(0, 2)}) ${value.substring(2, 7)}-${value.substring(7)}`;
      } else {
        // Limitar a 11 d√≠gitos
        value = value.substring(0, 11);
        formattedValue = `(${value.substring(0, 2)})${value.substring(2, 7)}-${value.substring(7)}`;
      }
      
      e.target.value = formattedValue;
    });

    document.getElementById('whatsapp').addEventListener('keydown', function (e) {
      // Permitir backspace, delete, tab, escape, enter
      if ([8, 9, 27, 13, 46].indexOf(e.keyCode) !== -1 ||
        // Permitir Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
        (e.keyCode === 65 && e.ctrlKey === true) ||
        (e.keyCode === 67 && e.ctrlKey === true) ||
        (e.keyCode === 86 && e.ctrlKey === true) ||
        (e.keyCode === 88 && e.ctrlKey === true)) {
        return;
      }
      // Garantir que √© um n√∫mero
      if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
        e.preventDefault();
      }
    });

    // Tratar especialmente o backspace para limpar melhor
    document.getElementById('whatsapp').addEventListener('keydown', function (e) {
      if (e.keyCode === 8) { // Backspace
        const currentValue = e.target.value;
        const cursorPosition = e.target.selectionStart;
        
        // Se o cursor est√° numa posi√ß√£o de caractere especial, mover para o d√≠gito anterior
        if (cursorPosition > 0) {
          const charAtCursor = currentValue[cursorPosition - 1];
          if (charAtCursor === ')' || charAtCursor === '-') {
            e.preventDefault();
            // Remover o d√≠gito anterior ao caractere especial
            const newValue = currentValue.substring(0, cursorPosition - 2) + currentValue.substring(cursorPosition);
            e.target.value = newValue;
            // Reposicionar cursor
            setTimeout(() => {
              e.target.setSelectionRange(cursorPosition - 2, cursorPosition - 2);
            }, 0);
            // Disparar evento input para reaplicar a m√°scara
            e.target.dispatchEvent(new Event('input'));
          }
        }
      }
    });

    // Tratar paste e casos especiais
    document.getElementById('whatsapp').addEventListener('paste', function (e) {
      e.preventDefault();
      const pastedText = (e.clipboardData || window.clipboardData).getData('text');
      const digitsOnly = pastedText.replace(/\D/g, '');
      
      // Aplicar m√°scara aos d√≠gitos colados
      let formattedValue = '';
      if (digitsOnly.length === 0) {
        formattedValue = '';
      } else if (digitsOnly.length <= 2) {
        formattedValue = `(${digitsOnly}`;
      } else if (digitsOnly.length <= 7) {
        formattedValue = `(${digitsOnly.substring(0, 2)})${digitsOnly.substring(2)}`;
      } else if (digitsOnly.length <= 11) {
        formattedValue = `(${digitsOnly.substring(0, 2)})${digitsOnly.substring(2, 7)}-${digitsOnly.substring(7)}`;
      } else {
        // Limitar a 11 d√≠gitos
        const limitedDigits = digitsOnly.substring(0, 11);
        formattedValue = `(${limitedDigits.substring(0, 2)})${limitedDigits.substring(2, 7)}-${limitedDigits.substring(7)}`;
      }
      
      e.target.value = formattedValue;
    });

    function hideAllSections() {
      document.querySelectorAll('.service-section').forEach(section => {
        section.classList.remove('active');
      });
    }

    function showSection(sectionId) {
      document.getElementById(sectionId).classList.add('active');
    }

    function updateProgress() {
      const form = document.getElementById('senaiForm');
      const allInputs = form.querySelectorAll('input[required], select[required], textarea[required]');
      
      // Filtrar apenas campos vis√≠veis
      const visibleInputs = Array.from(allInputs).filter(input => {
        const parent = input.closest('.form-group, .service-section');
        return parent && window.getComputedStyle(parent).display !== 'none';
      });
      
      const filledInputs = visibleInputs.filter(input => {
        if (input.type === 'checkbox' || input.type === 'file') return true;
        return input.value.trim() !== '';
      });

      const progress = visibleInputs.length > 0 ? Math.min((filledInputs.length / visibleInputs.length) * 100, 100) : 25;
      document.getElementById('progressFill').style.width = progress + '%';
    }

    function validateForm() {
      const servico = document.getElementById('servico').value;

      if (!document.getElementById('colaborador').value.trim()) {
        showStatus('Por favor, informe o nome do colaborador.', 'error');
        return false;
      }

      if (!document.getElementById('email').value.trim()) {
        showStatus('Por favor, informe o email.', 'error');
        return false;
      }

      if (!document.getElementById('whatsapp').value.trim()) {
        showStatus('Por favor, informe o WhatsApp.', 'error');
        return false;
      }

      // Validar formato do WhatsApp
      const whatsapp = document.getElementById('whatsapp').value.replace(/\D/g, '');
      if (whatsapp.length !== 11) {
        showStatus('WhatsApp deve ter 11 d√≠gitos: (xx)xxxxx-xxxx', 'error');
        return false;
      }

      if (!servico) {
        showStatus('Por favor, selecione um servi√ßo.', 'error');
        return false;
      }

      // Valida√ß√µes espec√≠ficas por servi√ßo
      if (servico === 'espaco_maker') {
        if (!document.getElementById('dataReserva').value) {
          showStatus('Por favor, informe a data de reserva.', 'error');
          return false;
        }
        if (!document.getElementById('horarioInicio').value) {
          showStatus('Por favor, informe o hor√°rio de in√≠cio.', 'error');
          return false;
        }
        if (!document.getElementById('horarioFim').value) {
          showStatus('Por favor, informe o hor√°rio de fim.', 'error');
          return false;
        }
        if (!document.getElementById('descricaoUtilizacao').value.trim()) {
          showStatus('Por favor, descreva a utiliza√ß√£o.', 'error');
          return false;
        }
      } else if (servico === 'servicos') {
        const tipoServico = document.getElementById('tipoServicoSelect').value;
        if (!tipoServico) {
          showStatus('Por favor, selecione o tipo de servi√ßo.', 'error');
          return false;
        }

        if (tipoServico === 'impressao') {
          if (!document.getElementById('tamanhoFolha').value) {
            showStatus('Por favor, selecione o tamanho da folha.', 'error');
            return false;
          }
          if (!document.getElementById('qtdCopias').value) {
            showStatus('Por favor, informe a quantidade de c√≥pias.', 'error');
            return false;
          }

          // Validar limites
          const tamanho = document.getElementById('tamanhoFolha').value;
          const qtd = parseInt(document.getElementById('qtdCopias').value);
          const frenteVerso = document.getElementById('frenteVerso').checked;

          let limite;
          if (tamanho === 'A3') {
            limite = frenteVerso ? 5 : 10;
          } else {
            limite = frenteVerso ? 60 : 30;
          }

          if (qtd > limite) {
            showStatus(`Limite excedido! M√°ximo: ${limite} folhas.`, 'error');
            return false;
          }
        } else if (tipoServico === 'impressao_3d') {
          if (!document.getElementById('material').value) {
            showStatus('Por favor, selecione o material.', 'error');
            return false;
          }
          if (!document.getElementById('quantidade3d').value) {
            showStatus('Por favor, informe a quantidade.', 'error');
            return false;
          }

          const possuiSTL = document.getElementById('possuiSTL').checked;
          if (!possuiSTL && !document.getElementById('descricaoPeca').value.trim()) {
            showStatus('Por favor, descreva a pe√ßa ou anexe arquivo STL.', 'error');
            return false;
          }
        } else if (tipoServico === 'manutencao') {
          if (!document.getElementById('descricaoProblema').value.trim()) {
            showStatus('Por favor, descreva o problema.', 'error');
            return false;
          }
        } else if (tipoServico === 'arte_digital' || tipoServico === 'projeto') {
          if (!document.getElementById('descricaoArteProjeto').value.trim()) {
            showStatus('Por favor, descreva o projeto.', 'error');
            return false;
          }
        }
      } else if (servico === 'emprestimo') {
        if (!document.getElementById('nomeItem').value.trim()) {
          showStatus('Por favor, informe o nome do item.', 'error');
          return false;
        }
        if (!document.getElementById('dataRetirada').value) {
          showStatus('Por favor, informe a data de retirada.', 'error');
          return false;
        }
        if (!document.getElementById('dataDevolucao').value) {
          showStatus('Por favor, informe a data de devolu√ß√£o.', 'error');
          return false;
        }
        if (!multiFileManagers['fotoItem'] || !multiFileManagers['fotoItem'].hasFiles()) {
          showStatus('Por favor, anexe pelo menos uma foto do item.', 'error');
          return false;
        }
      }

      return true;
    }

    document.getElementById('senaiForm').addEventListener('submit', function (e) {
      e.preventDefault();
      if (validateForm()) {
        submitForm();
      }
    });

    function resetForm() {
      document.getElementById('senaiForm').reset();
      hideAllSections();
      
      // Resetar campos espec√≠ficos
      document.getElementById('tipoServico').style.display = 'none';
      document.getElementById('tipoServicoSelect').value = '';
      document.getElementById('qtdChromeBooks').style.display = 'none';
      document.getElementById('qtdComputadores').style.display = 'none';
      document.getElementById('arquivoSTLGroup').style.display = 'block';
      document.getElementById('descricaoPecaGroup').style.display = 'none';
      
      // Limpar todos os gerenciadores de m√∫ltiplos arquivos
      Object.values(multiFileManagers).forEach(manager => {
        if (manager) {
          manager.clear();
        }
      });
      
      // Resetar tela
      document.getElementById('formContent').style.display = 'block';
      document.getElementById('successMessage').classList.remove('show');
      document.getElementById('submissionId').textContent = '';
      document.getElementById('submitBtn').disabled = false;
      document.getElementById('btnText').style.display = 'inline';
      document.getElementById('loadingText').style.display = 'none';
      updateProgress();
    }

    document.getElementById('dataDevolucao').addEventListener('change', function () {
      const dataRetirada = document.getElementById('dataRetirada').value;
      const dataDevolucao = this.value;

      if (dataRetirada && dataDevolucao && new Date(dataDevolucao) <= new Date(dataRetirada)) {
        showStatus('A data de devolu√ß√£o deve ser posterior √† data de retirada!', 'error');
        this.value = '';
      }
    });

    document.addEventListener('input', updateProgress);
    document.addEventListener('change', updateProgress);

    // Inicializa√ß√£o
    initializeMultiFileManagers();
    updateProgress();
    usageMonitor.reset();

    showStatus('‚úÖ Sistema carregado - GitHub Storage ativo!', 'success');

    console.log(`
üî• SENAI Lab - GitHub Storage (NOVO PADR√ÉO)
üìä Recursos utilizados:
   ‚Ä¢ Firestore: 20.000 writes/dia (gratuito)
   ‚Ä¢ GitHub: 1GB storage + 5k requests/hora (gratuito)
   ‚Ä¢ Firebase Hosting: 10GB (gratuito)

üí° Funcionalidades ativas:
   ‚úÖ Upload autom√°tico para GitHub
   ‚úÖ Compress√£o autom√°tica de imagens
   ‚úÖ Progress bars visuais
   ‚úÖ NOVO: Pasta √∫nica organizacional
   ‚úÖ NOVO: Nomenclatura padronizada
   ‚úÖ URLs p√∫blicas permanentes
   ‚úÖ Retry autom√°tico em falhas

üéØ 100% Gratuito - Custo: R$ 0,00

üìÇ Nova Estrutura GitHub:
   üìÅ senai-arquivos/
      ÔøΩ TIPO_DATA_SOLICITANTE_ARQUIVO
      üìÑ Ex: IMPRESSAO_20250715_123000_JOAO_documento.pdf
      ÔøΩ Ex: EMPRESTIMO_20250715_140500_MARIA_foto.jpg
      ÔøΩ Ex: MANUTENCAO_20250715_160000_PEDRO_problema.png

üè¢ Organiza√ß√£o: Senai-BAL
üìÅ Reposit√≥rio: senai-lab-arquivos
        `);
  </script>
</body>

</html>